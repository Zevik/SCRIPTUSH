<!DOCTYPE html>
<html dir="rtl" lang="he">
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×™×•××Ÿ ××©×™××•×ª ××™× ×˜×¨××§×˜×™×‘×™</title>
    <style>
      /* ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ ×•×¨×¡×¤×•× ×¡×™×‘×™ ×¢× ×ª××™×›×” ××œ××” ×‘-RTL */
      body {
        font-family: 'Rubik', 'Arial', sans-serif;
        background-color: #f0f2f5;
        margin: 0;
        padding: 20px;
        color: #333;
        direction: rtl;
      }
      .container {
        max-width: 800px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      h1 {
        color: #1a73e8;
        text-align: center;
      }
      .task-list {
        list-style: none;
        padding: 0;
      }
      .task-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #ddd;
        transition: background-color 0.3s;
      }
      .task-item:last-child {
        border-bottom: none;
      }
      .task-item.completed {
        text-decoration: line-through;
        color: #888;
      }
      .task-item:hover {
        background-color: #f9f9f9;
      }
      .task-item input[type="checkbox"] {
        margin-left: 15px;
      }
      .task-content {
        flex-grow: 1;
      }
      .task-date {
        color: #666;
        font-size: 0.85em;
        margin-right: 8px;
      }
      .task-actions {
        margin-right: auto;
        display: flex;
      }
      .task-actions button {
        background: none;
        border: none;
        cursor: pointer;
        color: #666;
        margin-right: 8px;
        font-size: 18px;
        transition: color 0.3s;
      }
      .task-actions button:hover {
        color: #e53935;
      }
      .btn {
        padding: 10px 15px;
        background-color: #1a73e8;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .btn:hover {
        background-color: #1558b3;
      }
      .btn-danger {
        background-color: #e53935;
      }
      .btn-danger:hover {
        background-color: #c62828;
      }
      
      .task-input-container {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 20px;
        gap: 10px;
      }
      .task-input-container input[type="text"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        min-width: 200px;
      }
      .task-input-container input[type="date"] {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
      }
      
      .task-filters {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        gap: 10px;
      }
      .task-filters button {
        padding: 8px 15px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
      }
      .task-filters button.active {
        background-color: #1a73e8;
        color: white;
        border-color: #1a73e8;
      }
      
      .task-stats {
        display: flex;
        justify-content: space-around;
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin-top: 30px;
      }
      .stat-box {
        text-align: center;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #1a73e8;
      }
      
      /* ×”×•×“×¢×•×ª ××¢×¨×›×ª */
      .message-box {
        display: none;
        padding: 15px;
        margin: 15px 0;
        border-radius: 5px;
        text-align: center;
        animation: fadeIn 0.5s;
      }
      .message-box.success {
        background-color: #e8f5e9;
        color: #2e7d32;
        border-left: 5px solid #2e7d32;
      }
      .message-box.error {
        background-color: #ffebee;
        color: #c62828;
        border-left: 5px solid #c62828;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      /* ×¢×™×¦×•×‘ ×¨×¡×¤×•× ×¡×™×‘×™ ×œ××¡×›×™× ×§×˜× ×™× */
      @media (max-width: 600px) {
        body {
          padding: 10px;
        }
        .container {
          padding: 15px;
        }
        .task-filters {
          flex-direction: column;
        }
        .task-actions {
          margin-top: 10px;
          justify-content: flex-start;
        }
        .task-date {
          display: block;
          margin-top: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>×™×•××Ÿ ×”××©×™××•×ª ×”××™× ×˜×¨××§×˜×™×‘×™ ×©×œ×™</h1>
      
      <!-- ×”×•×“×¢×•×ª ××¢×¨×›×ª -->
      <div id="messageBox" class="message-box"></div>
      
      <!-- ×˜×•×¤×¡ ×”×•×¡×¤×ª ××©×™××” -->
      <div class="task-input-container">
        <input type="text" id="newTaskInput" placeholder="×”×•×¡×£ ××©×™××” ×—×“×©×”..." />
        <input type="date" id="newTaskDate" />
        <button class="btn" onclick="addNewTask()">×”×•×¡×£</button>
      </div>
      
      <!-- ×¡×™× ×•×Ÿ ××©×™××•×ª -->
      <div class="task-filters">
        <button id="filterAll" class="active" onclick="filterTasks('all')">×”×›×œ</button>
        <button id="filterActive" onclick="filterTasks('active')">×¤×¢×™×œ×•×ª</button>
        <button id="filterCompleted" onclick="filterTasks('completed')">×”×•×©×œ××•</button>
      </div>
      
      <!-- ×¨×©×™××ª ××©×™××•×ª -->
      <ul id="taskList" class="task-list">
        <!-- ××©×™××•×ª ×™×ª×•×•×¡×¤×• ×›××Ÿ ×“×™× ××™×ª -->
      </ul>
      
      <!-- ×›×¤×ª×•×¨×™ × ×™×”×•×œ ××©×™××•×ª -->
      <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <button class="btn" onclick="saveTasksToFile()">×™×¦×•× ××©×™××•×ª</button>
        <button class="btn btn-danger" onclick="clearCompletedTasks()">××—×§ ××©×™××•×ª ×©×”×•×©×œ××•</button>
      </div>
      
      <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×™××•×ª -->
      <div class="task-stats">
        <div class="stat-box">
          <div class="stat-number" id="totalTasks">0</div>
          <div>×¡×”"×› ××©×™××•×ª</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="completedTasks">0</div>
          <div>×”×•×©×œ××•</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="pendingTasks">0</div>
          <div>×‘×ª×”×œ×™×š</div>
        </div>
      </div>
    </div>

    <script>
      // ××¢×¨×š ×”××©×™××•×ª
      let tasks = [];
      let currentFilter = 'all';
      
      // ×˜×¢×™× ×ª ××©×™××•×ª ×‘×˜×¢×™× ×ª ×”×“×£
      document.addEventListener('DOMContentLoaded', () => {
        // ×‘×¢×ª×™×“ × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›××Ÿ ×§×¨×™××” ×œ×©×¨×ª ×œ×˜×¢×™× ×ª ××©×™××•×ª
        // google.script.run.withSuccessHandler(function(loadedTasks) {
        //   tasks = loadedTasks;
        //   renderTasks();
        //   updateTaskStats();
        // }).loadTasksFromSheet();
        
        renderTasks();
        updateTaskStats();
      });
      
      // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×”××©×™××•×ª
      function saveTasks() {
        // ×©××™×¨×” ×¨×§ ×‘×–×™×›×¨×•×Ÿ ×”×–×× ×™
        // ×‘×¢×ª×™×“ × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›××Ÿ ×©××™×¨×” ×œ×©×¨×ª
        // google.script.run.saveTasksToSheet(tasks);
        updateTaskStats();
      }
      
      // ×”×¤×•× ×§×¦×™×” ×”×–××ª ×§×™×™××ª ×œ×¦×•×¨×š ×ª××™×›×” ×‘×”×¨×—×‘×” ×¢×ª×™×“×™×ª
      function loadTasks() {
        // ×›×¨×’×¢ ××™×Ÿ ×˜×¢×™× ×ª ××©×™××•×ª ×××§×•×¨ ×—×™×¦×•× ×™
        renderTasks();
      }
      
      // ×”×•×¡×¤×ª ××©×™××” ×—×“×©×”
      function addNewTask() {
        const taskInput = document.getElementById('newTaskInput');
        const dateInput = document.getElementById('newTaskDate');
        
        if (taskInput.value.trim() === '') {
          showMessage('× × ×œ×”×–×™×Ÿ ×ª×•×›×Ÿ ×œ××©×™××”', 'error');
          return;
        }
        
        const newTask = {
          id: Date.now(),
          text: taskInput.value.trim(),
          completed: false,
          date: dateInput.value || null,
          createdAt: new Date().toISOString()
        };
        
        tasks.push(newTask);
        saveTasks();
        renderTasks();
        
        // × ×§×” ××ª ×”×©×“×•×ª
        taskInput.value = '';
        dateInput.value = '';
        
        showMessage(`×”××©×™××” "${newTask.text}" × ×•×¡×¤×” ×‘×”×¦×œ×—×”!`, 'success');
      }
      
      // ×¢×“×›×•×Ÿ/×¨×™× ×“×•×¨ ×¨×©×™××ª ×”××©×™××•×ª
      function renderTasks() {
        const taskList = document.getElementById('taskList');
        taskList.innerHTML = '';
        
        // ×¡×™× ×•×Ÿ ×”××©×™××•×ª ×œ×¤×™ ×”×¤×™×œ×˜×¨ ×”× ×•×›×—×™
        const filteredTasks = tasks.filter(task => {
          if (currentFilter === 'all') return true;
          if (currentFilter === 'active') return !task.completed;
          if (currentFilter === 'completed') return task.completed;
        });
        
        if (filteredTasks.length === 0) {
          taskList.innerHTML = '<li class="task-item" style="justify-content: center; color: #888;">××™×Ÿ ××©×™××•×ª ×œ×”×¦×’×”</li>';
          return;
        }
        
        filteredTasks.forEach(task => {
          const listItem = document.createElement('li');
          listItem.className = `task-item ${task.completed ? 'completed' : ''}`;
          listItem.dataset.id = task.id;
          
          let dateText = '';
          if (task.date) {
            const taskDate = new Date(task.date);
            dateText = `<span class="task-date">${taskDate.toLocaleDateString('he-IL')}</span>`;
          }
          
          listItem.innerHTML = `
            <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${task.id})">
            <div class="task-content">
              <span>${task.text}</span>
              ${dateText}
            </div>
            <div class="task-actions">
              <button onclick="editTask(${task.id})" title="×¢×¨×•×š">âœï¸</button>
              <button onclick="deleteTask(${task.id})" title="××—×§">ğŸ—‘ï¸</button>
            </div>
          `;
          
          taskList.appendChild(listItem);
        });
      }
      
      // ×¡×™××•×Ÿ ××©×™××” ×›×”×•×©×œ××”/×œ× ×”×•×©×œ××”
      function toggleTask(id) {
        const taskIndex = tasks.findIndex(task => task.id === id);
        if (taskIndex !== -1) {
          tasks[taskIndex].completed = !tasks[taskIndex].completed;
          saveTasks();
          renderTasks();
          
          if (tasks[taskIndex].completed) {
            showMessage('×›×œ ×”×›×‘×•×“! ×”××©×™××” ×”×•×©×œ××”', 'success');
          }
        }
      }
      
      // ×¢×¨×™×›×ª ××©×™××”
      function editTask(id) {
        const task = tasks.find(task => task.id === id);
        if (!task) return;
        
        const newText = prompt('×¢×¨×™×›×ª ××©×™××”:', task.text);
        if (newText !== null && newText.trim() !== '') {
          task.text = newText.trim();
          saveTasks();
          renderTasks();
          showMessage('×”××©×™××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”', 'success');
        }
      }
      
      // ××—×™×§×ª ××©×™××”
      function deleteTask(id) {
        if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××©×™××” ×–×•?')) {
          tasks = tasks.filter(task => task.id !== id);
          saveTasks();
          renderTasks();
          showMessage('×”××©×™××” × ××—×§×” ×‘×”×¦×œ×—×”', 'success');
        }
      }
      
      // ×¡×™× ×•×Ÿ ××©×™××•×ª
      function filterTasks(filter) {
        currentFilter = filter;
        
        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×”×¡×™× ×•×Ÿ
        document.getElementById('filterAll').classList.remove('active');
        document.getElementById('filterActive').classList.remove('active');
        document.getElementById('filterCompleted').classList.remove('active');
        document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`).classList.add('active');
        
        renderTasks();
      }
      
      // ××—×™×§×ª ×›×œ ×”××©×™××•×ª ×©×”×•×©×œ××•
      function clearCompletedTasks() {
        const completedCount = tasks.filter(task => task.completed).length;
        
        if (completedCount === 0) {
          showMessage('××™×Ÿ ××©×™××•×ª ×©×”×•×©×œ××• ×œ××—×™×§×”', 'error');
          return;
        }
        
        if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ${completedCount} ××©×™××•×ª ×©×”×•×©×œ××•?`)) {
          tasks = tasks.filter(task => !task.completed);
          saveTasks();
          renderTasks();
          showMessage('×”××©×™××•×ª ×©×”×•×©×œ××• × ××—×§×• ×‘×”×¦×œ×—×”', 'success');
        }
      }
      
      // ×™×¦×•× ××©×™××•×ª ×œ×§×•×‘×¥
      function saveTasksToFile() {
        if (tasks.length === 0) {
          showMessage('××™×Ÿ ××©×™××•×ª ×œ×™×¦×•×', 'error');
          return;
        }
        
        const taskData = JSON.stringify(tasks, null, 2);
        const blob = new Blob([taskData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `tasks-${new Date().toISOString().slice(0, 10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        showMessage('×”××©×™××•×ª ×™×•×¦××• ×‘×”×¦×œ×—×”', 'success');
      }
      
      // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×™××•×ª
      function updateTaskStats() {
        document.getElementById('totalTasks').textContent = tasks.length;
        document.getElementById('completedTasks').textContent = tasks.filter(task => task.completed).length;
        document.getElementById('pendingTasks').textContent = tasks.filter(task => !task.completed).length;
      }
      
      // ×”×¦×’×ª ×”×•×“×¢×•×ª ××¢×¨×›×ª
      function showMessage(message, type) {
        const messageBox = document.getElementById('messageBox');
        messageBox.textContent = message;
        messageBox.className = `message-box ${type}`;
        messageBox.style.display = 'block';
        
        // ×”×¡×ª×¨×ª ×”×”×•×“×¢×” ×œ××—×¨ 3 ×©× ×™×•×ª
        setTimeout(() => {
          messageBox.style.display = 'none';
        }, 3000);
      }
    </script>
  </body>
</html>